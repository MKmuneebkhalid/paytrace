PayTrace Card-on-File Integration
==================================

SETUP STEPS
-----------

1. Install dependencies:
   npm install

2. Create .env file from env.example:
   cp env.example .env

3. Fill in your PayTrace credentials in .env:
   - PAYTRACE_API_URL: Use sandbox URL for testing, production URL for live
   - PAYTRACE_USERNAME: Your PayTrace API username
   - PAYTRACE_PASSWORD: Your PayTrace API password
   - PAYTRACE_INTEGRATOR_ID: Your assigned integrator ID

4. (Optional) Configure SendGrid for sending payment links:
   - SENDGRID_API_KEY: Your SendGrid API key (starts with "SG.")
   - EMAIL_FROM: Display name and email for sent emails
   - NOTIFICATION_EMAILS: (Optional) Comma-separated list for notifications
   
   âš ï¸ SENDGRID SETUP STEPS:
   
   a) Sign up for free at https://sendgrid.com (100 emails/day free)
   b) Verify your email address
   c) Go to Settings â†’ API Keys in SendGrid dashboard
   d) Click "Create API Key"
   e) Name it "PayTrace App" and select "Full Access"
   f) Copy the API key (you won't see it again!)
   g) Add to .env: SENDGRID_API_KEY=SG.your-key-here
   
   h) IMPORTANT - Verify sender emails:
      - Go to Settings â†’ Sender Authentication
      - Click "Verify a Single Sender"
      - Add and verify each email you'll send from
      - This includes the EMAIL_FROM and any Zoho account owner emails
   
   ðŸ’¡ TIP: The app works without email configured - it will just skip sending.
        Payment links can still be copied and shared manually from the admin panel.

5. Run the server:
   npm run dev    (development with auto-reload)
   npm start      (production)

6. Open http://localhost:3000 in your browser


GETTING PAYTRACE CREDENTIALS
----------------------------

1. Log into your PayTrace merchant dashboard
2. Go to Settings > API Credentials
3. Generate/copy your username and password
4. Request an Integrator ID from PayTrace support if you don't have one

Sandbox URLs:
- API: https://api.sandbox.paytrace.com
- Documentation: https://developers.paytrace.com

Production URLs:
- API: https://api.paytrace.com


API ENDPOINTS
-------------

GET  /api/protect-key           - Get client key for Protect.js initialization
POST /api/customers             - Create new customer profile with card on file
GET  /api/customers/:id         - Get customer profile details
PUT  /api/customers/:id         - Update customer card/billing info
DELETE /api/customers/:id       - Delete customer profile


HOW IT WORKS
------------

1. Client visits the secure form page
2. Page loads PayTrace Protect.js (hosted payment fields via iframe)
3. Card number and CVV are entered into PayTrace-hosted fields
4. When submitted, Protect.js encrypts and returns a one-time token (hpf_token)
5. Your server receives only the token, never the raw card data
6. Server calls PayTrace API to create customer profile in their vault
7. PayTrace returns customer_id and masked card number
8. You store customer_id (not card data) for future reference

This keeps you PCI-compliant (SAQ-A level) since card data never touches your servers.


FUTURE TRANSACTIONS
-------------------

When you need to charge a stored card later:

POST /v1/transactions/sale/by_customer
{
  "integrator_id": "your_integrator_id",
  "customer_id": "the_stored_customer_id",
  "amount": 100.00
}

This functionality can be added to the service when needed.


NEXT STEPS (ZOHO INTEGRATION)
-----------------------------

For Zoho Sign integration, you'll need to:

1. Set up a Zoho Sign webhook that triggers when a contract is sent
2. The webhook will call your API with client info
3. Your API generates a unique link to the card collection form
4. That link gets sent to the client (via email or embedded in Zoho workflow)
5. Client fills out form, card is saved to PayTrace vault
6. You store the mapping: Zoho Contact ID -> PayTrace Customer ID
